<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BLACKJ Trainer</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main id="app" class="app">
    <div class="header">
      <div class="header-left">
        <h1>BLACKJ Trainer</h1>
        <div class="badge">Ultra-Low-Latency</div>
      </div>
      <div class="header-actions">
        <button id="settingsBtn" class="icon-btn" type="button" aria-label="Open settings">⚙</button>
      </div>
    </div>

    <div class="rule-strip">
      6D • Dealer hits soft 17 • Blackjack 3:2 • Double after split • One split max • Split Aces one card • Insurance allowed • No surrender
    </div>

    <section class="topline">
      <div class="panel count-block" data-role="rc">
        <div class="label">RC</div>
        <div id="rcVal" class="value">0</div>
      </div>

      <div class="panel count-block" data-role="tc">
        <div class="label">TC</div>
        <div class="tc-wrap">
          <div id="tcVal" class="value tc">0</div>
          <div id="bandBadge" class="band">NEUTRAL</div>
          <div id="edgeVal" class="edge-pill">-0.55%</div>
          <button id="edgeToggle" class="icon-btn" type="button" aria-label="Toggle edge/bet display">◎</button>
        </div>
        <div class="mini-meta">
          <span class="mini-pill"><span class="mini-key">Count</span> <span id="countSysLabel" class="mono">Hi-Lo</span></span>
          <span class="mini-pill"><span class="mini-key">Decks</span> <span id="decksLabel" class="mono">6</span></span>
          <span class="mini-pill"><span class="mini-key">Mode</span> <span id="tcModeLabel" class="mono">SIM</span></span>
          <span class="mini-pill mini-ace hidden" id="aceSidePill"><span class="mini-key">Ace side</span> <span id="aceSideLabel" class="mono">OFF</span></span>
          <span class="mini-pill mini-ace hidden" id="aceDeltaPill"><span class="mini-key">A seen</span> <span id="acesSeenLabel" class="mono">0</span></span>
        </div>
      </div>

      <div class="panel action-block">
        <div class="label">Action</div>
        <div id="actionVal" class="action-text">—</div>
        <div class="bet-line">Bet: <span id="betVal" class="bet-pill">—</span></div>
      </div>
    </section>

    <section class="guide panel">
      <div class="label">Move Guide</div>
      <div id="guideLine" class="guide-line">Waiting for cards…</div>
    </section>

    <section id="grid" class="grid">
      <div class="card-target panel">
        <div class="sub-label">Target</div>
        <div id="targetVal" class="pill">TABLE</div>
      </div>
      <div class="card-lists panel">
        <div class="sub-label">Player</div>
        <div id="playerCards" class="cards"></div>
      </div>
      <div class="card-lists panel">
        <div class="sub-label">Dealer</div>
        <div id="dealerCards" class="cards"></div>
      </div>
      <div class="meta panel">
        <div class="sub-label">Decks Seen</div>
        <div id="decksSeenVal" class="mono">0.00</div>
      </div>
      <div class="meta panel">
        <div class="sub-label">Cards Dealt</div>
        <div id="cardsDealtVal" class="mono">0</div>
      </div>
      <div class="meta panel">
        <div class="sub-label">Decks Remaining</div>
        <div id="decksRemainVal" class="mono">—</div>
      </div>
      <div class="meta panel">
        <div class="sub-label">Aces Seen (side)</div>
        <div id="acesSeenVal" class="mono">0</div>
      </div>
    </section>

    <section id="controls" class="controls">
      <button id="noiseBtn" type="button" class="control">Noise (N)</button>
      <button id="hardcoreBtn" type="button" class="control">Hardcore (M)</button>
      <button id="perfBtn" type="button" class="control">Perf (F)</button>
      <button id="overlayBtn" type="button" class="control">Overlay (O)</button>
      <button id="nextHandBtn" type="button" class="control">Next Hand (Enter)</button>
      <button id="resetBtn" type="button" class="control">Reset (X)</button>
    </section>

    <section class="pad panel">
      <div class="pad-row targets">
        <span class="label">Target</span>
        <div class="target-buttons">
          <button class="chip-btn" data-target="player" id="btnPlayer">Player (P)</button>
          <button class="chip-btn" data-target="dealer" id="btnDealer">Dealer (D)</button>
          <button class="chip-btn" data-target="table" id="btnTable">Table (B)</button>
        </div>
      </div>
      <div class="pad-row cards">
        <span class="label">Add Card</span>
        <div class="card-buttons">
          <button class="chip-btn" data-rank="2">2</button>
          <button class="chip-btn" data-rank="3">3</button>
          <button class="chip-btn" data-rank="4">4</button>
          <button class="chip-btn" data-rank="5">5</button>
          <button class="chip-btn" data-rank="6">6</button>
          <button class="chip-btn" data-rank="7">7</button>
          <button class="chip-btn" data-rank="8">8</button>
          <button class="chip-btn" data-rank="9">9</button>
          <button class="chip-btn" data-rank="10">T</button>
          <button class="chip-btn" data-rank="A">A</button>
        </div>
      </div>
    </section>

    <section id="hints" class="hints">
      <div class="hint"><span class="mono">2-9, T/J/Q/K, A</span> add card to active target</div>
      <div class="hint"><span class="mono">P</span> player, <span class="mono">D</span> dealer, <span class="mono">B</span> table</div>
      <div class="hint"><span class="mono">Backspace</span> undo • <span class="mono">Enter</span> next hand • <span class="mono">X</span> reset • <span class="mono">O</span> overlay • <span class="mono">E</span> edge/bet • <span class="mono">S</span> settings</div>
    </section>

    <section id="overlay" class="overlay hidden">
      <div class="overlay-content">
        <h2>Quick Ref</h2>
        <div class="ref-grid">
          <div>
            <div class="ref-title">Controls</div>
            <ul class="ref-list">
              <li>Digits / T J Q K / A → add to target</li>
              <li>P / D / B → switch target</li>
              <li>N noise · M hardcore · O overlay</li>
              <li>Backspace undo · X reset · F perf HUD · E edge/bet</li>
              <li>S settings</li>
            </ul>
          </div>
          <div>
            <div class="ref-title">Count + TC</div>
            <ul class="ref-list">
              <li>SIM mode: TC uses cards dealt (training)</li>
              <li>CASINO mode: TC uses your tray estimate (decks remaining)</li>
              <li>Counts: Hi-Lo, Wong Halves, Hi-Opt II</li>
              <li>Hi-Opt II: enable Ace side count for betting accuracy</li>
            </ul>
          </div>
          <div>
            <div class="ref-title">Practice Drills</div>
            <ul class="ref-list">
              <li>Single-card: flip & call + / 0 / – instantly</li>
              <li>Running count: burn a deck, finish at 0</li>
              <li>Deck est.: eyeball discard tray → decks remaining</li>
              <li>Noise: train with distractions (TV/audio)</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Settings Drawer -->
    <div id="settingsBackdrop" class="backdrop hidden"></div>
    <aside id="settingsDrawer" class="drawer hidden" aria-hidden="true">
      <div class="drawer-head">
        <div class="drawer-title">Settings</div>
        <button id="settingsCloseBtn" class="icon-btn" type="button" aria-label="Close settings">✕</button>
      </div>

      <div class="drawer-body">
        <div class="form-grid">
          <label class="field">
            <span class="field-label">Count system</span>
            <select id="countSystemSelect" class="field-input">
              <option value="hilo">Hi-Lo</option>
              <option value="wong_halves">Wong Halves</option>
              <option value="hiopt2">Hi-Opt II (Ace-neutral)</option>
            </select>
          </label>

          <label class="field">
            <span class="field-label">Decks in shoe</span>
            <select id="decksSelect" class="field-input">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="4">4</option>
              <option value="6" selected>6</option>
              <option value="8">8</option>
            </select>
          </label>

          <label class="field field-wide">
            <span class="field-label">TC mode</span>
            <div class="seg">
              <button id="tcModeSimBtn" type="button" class="seg-btn active" data-mode="sim">SIM (cards dealt)</button>
              <button id="tcModeCasinoBtn" type="button" class="seg-btn" data-mode="casino">CASINO (tray est.)</button>
            </div>
          </label>

          <label class="field field-wide" id="aceSideField">
            <span class="field-label">Ace side count (Hi-Opt II)</span>
            <div class="seg">
              <button id="aceSideOnBtn" type="button" class="seg-btn" data-mode="on">On</button>
              <button id="aceSideOffBtn" type="button" class="seg-btn active" data-mode="off">Off</button>
            </div>
            <div class="field-hint">Tracks Aces separately and corrects TC/bet for Hi-Opt II. Aces add automatically when you log them.</div>
          </label>

          <label class="field field-wide" id="decksRemainField">
            <span class="field-label">Decks remaining (tray estimate)</span>
            <input id="decksRemainRange" class="range" type="range" min="0.25" max="8" step="0.25" value="3.00" />
            <div class="range-row">
              <span class="mono">0.25</span>
              <span id="decksRemainReadout" class="mono">3.00</span>
              <span class="mono">8.00</span>
            </div>
          </label>

          <label class="field">
            <span class="field-label">Bankroll (units)</span>
            <input id="bankrollInput" class="field-input" type="number" min="1" step="1" value="100" />
          </label>

          <label class="field">
            <span class="field-label">Kelly cap</span>
            <select id="kellySelect" class="field-input">
              <option value="0.10">1/10 Kelly</option>
              <option value="0.125">1/8 Kelly</option>
              <option value="0.1667">1/6 Kelly</option>
              <option value="0.20">1/5 Kelly</option>
              <option value="0.25" selected>1/4 Kelly</option>
            </select>
          </label>

          <div class="drawer-note">
            Edge and bet sizing are conservative estimates, intended for training and discipline, not for guaranteeing outcomes.
          </div>
        </div>
      </div>

      <div class="drawer-foot">
        <button id="settingsApplyBtn" type="button" class="control">Apply</button>
        <button id="settingsResetBtn" type="button" class="chip-btn">Reset prefs</button>
      </div>
    </aside>
  </main>

  <div id="toast" class="toast hidden"></div>
  <div id="perfHud" class="perf hidden">
    <div class="perf-line" id="perfFps">fps —</div>
    <div class="perf-line" id="perfFrames">frames —</div>
  </div>

  <script src="engine.js"></script>
  <script src="app.js"></script>
</body>
</html>
